<main class="container">
    <div class="game-guide">
        <strong>ğŸ›’ ì‹œì¥ì— ê°€ë©´... (AI ëŒ€ê²° ë²„ì „)</strong>
        1. AIê°€ ë¬¼ê±´ì„ í•˜ë‚˜ ì œì‹œí•©ë‹ˆë‹¤.<br>
        2. ì•ì„  ë¬¼ê±´ë“¤ì„ ìˆœì„œëŒ€ë¡œ ëˆ„ë¥¸ ë’¤, <b>ë§ˆì§€ë§‰ì— ë‚´ê°€ ì¶”ê°€í•  ë¬¼ê±´ í•˜ë‚˜ë¥¼ ë” ì„ íƒ</b>í•˜ì„¸ìš”.<br>
        3. ìˆœì„œê°€ ê¸¸ì–´ì§ˆìˆ˜ë¡ ë‹¹ì‹ ì˜ ì§‘ì¤‘ë ¥ ì ìˆ˜ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤!
    </div>
    
    <div id="status-msg">ì¤€ë¹„ë˜ë©´ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”!</div>
    
    <div id="display-box">
        <div id="current-item" style="font-size: 2.2rem; font-weight: 900; color: var(--accent-color);">READY</div>
    </div>
    
    <button id="startBtn" class="btn-start" onclick="startGame()">í›ˆë ¨ ì‹œì‘</button>
    
    <div id="game-ui" style="display: none;">
        <div class="item-grid" id="item-grid"></div>
    </div>

    </main>

<script>
    const itemList = ["ğŸ ì‚¬ê³¼", "ğŸŒ ë°”ë‚˜ë‚˜", "ğŸ‡ í¬ë„", "ğŸ¥• ë‹¹ê·¼", "ğŸ ë¹µ", "ğŸ¥š ê³„ë€", "ğŸ¥› ìš°ìœ ", "ğŸŸ ìƒì„ ", "ğŸ§€ ì¹˜ì¦ˆ"];
    let memoryChain = [], userStep = 0, isAITurn = false, isUserAdding = false;

    function startGame() {
        memoryChain = [];
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('game-ui').style.display = 'block';
        createGrid();
        aiTurn();
    }

    function createGrid() {
        const grid = document.getElementById('item-grid');
        grid.innerHTML = '';
        itemList.forEach(item => {
            const btn = document.createElement('button');
            btn.className = 'item-btn';
            btn.innerText = item;
            btn.onclick = () => handleInput(item);
            grid.appendChild(btn);
        });
    }

    async function aiTurn() {
        isAITurn = true; 
        isUserAdding = false;
        userStep = 0;
        document.getElementById('status-msg').innerText = "AIê°€ ë¬¼ê±´ì„ í•˜ë‚˜ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ê¸°ì–µí•˜ì„¸ìš”!";
        
        // AIê°€ ë¬¼ê±´ ì¶”ê°€
        const newItem = itemList[Math.floor(Math.random() * itemList.length)];
        memoryChain.push(newItem);

        // ì „ì²´ ëª©ë¡ ë³´ì—¬ì£¼ê¸°
        let speed = Math.max(400, 1000 - (memoryChain.length * 50));
        for (let item of memoryChain) {
            document.getElementById('current-item').innerText = item;
            await new Promise(r => setTimeout(r, speed));
            document.getElementById('current-item').innerText = "";
            await new Promise(r => setTimeout(r, 200));
        }
        userTurn();
    }

    function userTurn() {
        isAITurn = false;
        document.getElementById('status-msg').innerText = "ìˆœì„œëŒ€ë¡œ ë³µê¸°í•˜ì„¸ìš”!";
        document.getElementById('current-item').innerText = "???";
    }

    function handleInput(selectedItem) {
        if (isAITurn) return;

        document.getElementById('current-item').innerText = selectedItem;

        // 1. ê¸°ì¡´ ëª©ë¡ ë³µê¸° ë‹¨ê³„
        if (!isUserAdding) {
            if (selectedItem === memoryChain[userStep]) {
                userStep++;
                if (userStep === memoryChain.length) {
                    // ë³µê¸° ì™„ë£Œ -> ì´ì œ ì‚¬ìš©ìê°€ í•˜ë‚˜ ì¶”ê°€í•  ì°¨ë¡€
                    isUserAdding = true;
                    document.getElementById('status-msg').innerText = "ì˜í•˜ì…¨ì–´ìš”! ì¶”ê°€í•  ë¬¼ê±´ì„ í•˜ë‚˜ ê³ ë¥´ì„¸ìš”.";
                    document.getElementById('current-item').innerText = "+ ?";
                }
            } else {
                endGame();
            }
        } 
        // 2. ì‚¬ìš©ìê°€ ë¬¼ê±´ ì¶”ê°€ ë‹¨ê³„
        else {
            memoryChain.push(selectedItem);
            document.getElementById('status-msg').innerText = "ì„±ê³µ! AI ì°¨ë¡€ì…ë‹ˆë‹¤.";
            isUserAdding = false;
            setTimeout(aiTurn, 1000);
        }
    }

    function endGame() {
        const finalScore = memoryChain.length - 1;
        // ë“±ê¸‰ ê³„ì‚°
        let grade = finalScore >= 12 ? "ê¸°ì–µì˜ ì‹  ğŸ†" : finalScore >= 7 ? "ëª…ì„í•œ ë‘ë‡Œ ğŸ§ " : "ì˜ˆì—´ í•„ìš” ğŸ”¥";
        const msg = `í›ˆë ¨ ì¢…ë£Œ!\në“±ê¸‰: ${grade}\nìµœì¢… ê¸°ë¡: ${finalScore}ë‹¨ê³„\n\nì§€ê¸ˆ ë°”ë¡œ ë¶„ì„ ë¦¬í¬íŠ¸ë¥¼ í™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
        
        saveRecord(finalScore, msg);
        
        document.getElementById('startBtn').style.display = 'inline-block';
        document.getElementById('startBtn').innerText = 'ë‹¤ì‹œ ë„ì „í•˜ê¸°';
        document.getElementById('game-ui').style.display = 'none';
        document.getElementById('status-msg').innerText = 'í›ˆë ¨ ê²°ê³¼';
        document.getElementById('current-item').innerText = "FINISH";
    }

    function saveRecord(score, msg) {
        const now = new Date();
        const dateStr = `${now.getMonth()+1}/${now.getDate()}`;
        
        // íˆìŠ¤í† ë¦¬ ì €ì¥
        let history = JSON.parse(localStorage.getItem('marketHistory')) || [];
        history.unshift({ date: dateStr, score: score });
        localStorage.setItem('marketHistory', JSON.stringify(history.slice(0, 10)));

        // [ì¤‘ìš”] report.html ì—°ë™ ë°ì´í„°
        // Lv.15ë¥¼ 100ì ìœ¼ë¡œ í™˜ì‚°
        const reportScore = Math.min(100, Math.floor((score / 15) * 100));
        localStorage.setItem('game8_score', reportScore);
        
        displayHistory();
        if (confirm(msg)) { location.href = 'report.html'; }
    }
    // displayHistory, clearHistory í•¨ìˆ˜ëŠ” ë™ì¼í•¨
</script>
