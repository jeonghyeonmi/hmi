<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>N-Back ê¸°ì–µë ¥ í›ˆë ¨ | SKZ Brain Lab</title>
    <style>
        :root { --primary-color: #1a3a5f; --bg-color: #f4f7f9; --accent-color: #27ae60; --error-color: #e74c3c; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: 'Pretendard', sans-serif; background-color: var(--bg-color); color: #333; }
        
        /* ë©”ì¸ í—¤ë” */
        header { background: var(--primary-color); color: white; padding: 1.2rem; text-align: center; }
        header h1 { margin: 0; font-size: 1.4rem; font-weight: 800; }
        header h1 a { text-decoration: none; color: inherit; }

        /* ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ */
        nav.main-nav { 
            background: white; padding: 0.8rem; display: flex; justify-content: center; gap: 1.2rem; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000;
            overflow-x: auto; white-space: nowrap;
        }
        nav.main-nav a { text-decoration: none; color: var(--primary-color); font-weight: bold; font-size: 0.9rem; flex-shrink: 0; }
        nav.main-nav a.active { color: var(--accent-color); border-bottom: 2px solid var(--accent-color); }

        /* ì„œë¸Œ ë„¤ë¹„ê²Œì´ì…˜ (ì§‘ì¤‘ë ¥ ê²Œì„ ë¦¬ìŠ¤íŠ¸) */
        .sub-nav { display: flex; justify-content: center; gap: 15px; padding: 12px 0; background: #fff; border-bottom: 1px solid #eee; font-size: 0.75rem; }
        .sub-nav a { text-decoration: none; color: #aaa; font-weight: 500; }
        .sub-nav a.current { color: var(--accent-color); font-weight: bold; }

        .game-container {
            width: 94%; max-width: 500px; margin: 1.5rem auto; padding: 25px;
            background: white; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.04);
            text-align: center;
        }

        .info-bar { display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: bold; font-size: 0.9rem; color: #666; }
        #n-level-display { color: var(--accent-color); font-size: 1.1rem; }

        .display-area {
            height: 200px; background: #2c3e50; border-radius: 20px;
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 30px; position: relative; overflow: hidden;
        }
        #number-display { font-size: 5rem; font-weight: 900; color: #fff; transition: transform 0.1s; }

        .game-btns { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .match-btn { 
            padding: 22px; background: var(--primary-color); color: white; border: none; 
            border-radius: 18px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .match-btn:active { transform: scale(0.95); opacity: 0.9; }

        .btn-start { 
            width: 100%; padding: 18px; background: var(--accent-color); color: white; 
            border: none; border-radius: 30px; font-weight: bold; font-size: 1.1rem; cursor: pointer;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .ranking-box { margin-top: 30px; padding-top: 20px; border-top: 2px dashed #eee; text-align: left; }
        .ranking-title { font-size: 1rem; font-weight: bold; color: var(--primary-color); margin-bottom: 12px; }
        
        #current-grade { font-size: 1.3rem; font-weight: bold; margin-bottom: 5px; }
        #grade-info { font-size: 0.85rem; color: #888; }

        footer { text-align: center; padding: 2rem 0; color: #bbb; font-size: 0.8rem; }
    </style>
</head>
<body>
    <header><h1><a href="index.html">SKZ ë‘ë‡Œ í›ˆë ¨ì†Œ</a></h1></header>
    
    <nav class="main-nav">
        <a href="index.html">í™ˆ</a>
        <a href="game.html" class="active">ì§‘ì¤‘ë ¥</a>
        <a href="game2.html">ë…¼ë¦¬ë ¥</a>
        <a href="game3.html">íŒë‹¨ë ¥</a>
        <a href="report.html">ë¦¬í¬íŠ¸</a>
        <a href="posts.html">ë¶„ì„ì‹¤</a>
    </nav>

    <div class="sub-nav">
        <a href="game.html">[ê¸°ì´ˆí›ˆë ¨]</a>
        <a href="game8.html" class="current">[N-Backê¸°ì–µ]</a>
    </div>

    <main class="game-container">
        <div class="info-bar">
            <div id="n-level-display">Level: 1-Back</div>
            <div>Score: <span id="score">0</span></div>
        </div>

        <div class="display-area">
            <div id="number-display">?</div>
            <div id="feedback-layer" style="position:absolute; width:100%; height:100%; pointer-events:none; transition: 0.3s;"></div>
        </div>

        <div id="action-zone" style="display:none;">
            <button class="match-btn" onclick="handleMatch()">ë°©ê¸ˆ ìˆ«ìì™€ ê°™ìŒ!</button>
            <p style="font-size:0.8rem; color:#aaa; margin-top:12px;">ì¼ì¹˜í•  ë•Œë§Œ ë¹ ë¥´ê²Œ ëˆ„ë¥´ì„¸ìš”!</p>
        </div>

        <div class="start-overlay" id="setup-zone">
            <div style="margin-bottom:25px; font-size:0.95rem; color:#555; line-height:1.6;">
                <b>[í›ˆë ¨ ë°©ë²•]</b><br>
                ìˆ«ìê°€ ìˆœì„œëŒ€ë¡œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.<br>
                <b>Në²ˆì§¸ ì „</b>ì— ë‚˜ì˜¨ ìˆ«ìì™€ ì§€ê¸ˆ ìˆ«ìê°€<br>
                ê°™ë‹¤ë©´ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”!
            </div>
            <button class="btn-start" onclick="startGame()">í›ˆë ¨ ì‹œì‘í•˜ê¸°</button>
        </div>

        <div class="ranking-box">
            <div class="ranking-title">ğŸ… ë‚˜ì˜ ì§‘ì¤‘ë ¥ ë“±ê¸‰</div>
            <div id="current-grade" style="color:#ccc;">ì¸¡ì • ì „</div>
            <div id="grade-info">ì—°ì† ì„±ê³µí•˜ì—¬ ë ˆë²¨ì„ ë†’ì—¬ë³´ì„¸ìš”!</div>
        </div>
    </main>

    <footer>&copy; 2026 SKZ Brain Lab. All rights reserved.</footer>

    <script>
        let n = 1; 
        let sequence = [];
        let score = 0;
        let isGameActive = false;
        let gameInterval = null;
        let hasAnswered = false;
        let gameTimeLimit = 60; // 60ì´ˆ ê²Œì„

        const numView = document.getElementById('number-display');
        const scoreView = document.getElementById('score');
        const levelView = document.getElementById('n-level-display');
        const gradeView = document.getElementById('current-grade');
        const infoView = document.getElementById('grade-info');

        const grades = [
            { lv: 1, name: "ê¸ˆë¶•ì–´ ê¸°ì–µë ¥ ğŸŸ", color: "#95a5a6" },
            { lv: 2, name: "í‰ë²”í•œ ì§€êµ¬ì¸ ğŸ‘¨â€ğŸš€", color: "#3498db" },
            { lv: 3, name: "ë¹„ìƒí•œ ë‘ë‡Œ ğŸ¦Š", color: "#f1c40f" },
            { lv: 4, name: "ê¸°ì–µë ¥ ì²œì¬ ğŸ˜", color: "#9b59b6" },
            { lv: 5, name: "ì´ˆì¸ë¥˜ AI ğŸ¤–", color: "#e74c3c" }
        ];

        function loadBestRecord() {
            const bestLv = localStorage.getItem('nback_best_lv') || 0;
            if(bestLv > 0) {
                const myGrade = grades.find(g => g.lv == bestLv) || grades[grades.length-1];
                gradeView.innerText = myGrade.name;
                gradeView.style.color = myGrade.color;
                infoView.innerText = `ìµœê³  ë„ë‹¬ ë ˆë²¨: ${bestLv}-Back`;
            }
        }
        loadBestRecord();

        function startGame() {
            isGameActive = true;
            score = 0; n = 1; sequence = [];
            scoreView.innerText = "0";
            levelView.innerText = `Level: ${n}-Back`;
            document.getElementById('setup-zone').style.display = 'none';
            document.getElementById('action-zone').style.display = 'block';
            nextStep();
            
            // 60ì´ˆ í›„ ì¢…ë£Œ
            setTimeout(() => { if(isGameActive) endGame(); }, gameTimeLimit * 1000);
        }

        function nextStep() {
            if(!isGameActive) return;

            // ë†“ì¹œ ì •ë‹µ ì²´í¬
            if(sequence.length >= n + 1 && !hasAnswered) {
                if(sequence[sequence.length-1] === sequence[sequence.length-(n+1)]) {
                    score = Math.max(0, score - 1);
                }
            }

            hasAnswered = false;
            const nextNum = Math.floor(Math.random() * 9) + 1;
            sequence.push(nextNum);
            
            numView.innerText = nextNum;
            numView.style.transform = "scale(1.2)";
            setTimeout(() => { numView.style.transform = "scale(1)"; }, 100);

            // ë ˆë²¨ì—… (10ì ë‹¹ 1ë‹¨ê³„)
            if(score >= n * 10 && n < 5) {
                n++;
                levelView.innerText = `Level: ${n}-Back`;
                showToast(`ì¶•í•˜í•©ë‹ˆë‹¤! ${n}-Back ë ˆë²¨ì—…!`);
            }

            gameInterval = setTimeout(nextStep, 2000);
        }

        function handleMatch() {
            if(!isGameActive || hasAnswered) return;
            hasAnswered = true;

            const current = sequence[sequence.length - 1];
            const target = sequence[sequence.length - (n + 1)];

            if(sequence.length > n && current === target) {
                score += 3;
                triggerFeedback(true);
            } else {
                score = Math.max(0, score - 2);
                triggerFeedback(false);
            }
            scoreView.innerText = score;
        }

        function triggerFeedback(isCorrect) {
            const layer = document.getElementById('feedback-layer');
            layer.style.backgroundColor = isCorrect ? "rgba(39, 174, 96, 0.4)" : "rgba(231, 76, 60, 0.4)";
            setTimeout(() => { layer.style.backgroundColor = 'transparent'; }, 250);
        }

        function showToast(msg) {
            const t = document.createElement('div');
            t.style = "position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.85); color:white; padding:15px 30px; border-radius:50px; z-index:2000; font-weight:bold; animation: fadeIn 0.3s;";
            t.innerText = msg;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 1500);
        }

        function endGame() {
            isGameActive = false;
            clearTimeout(gameInterval);
            
            const lastBest = localStorage.getItem('nback_best_lv') || 0;
            if(n > lastBest) localStorage.setItem('nback_best_lv', n);
            localStorage.setItem('game8_score', score); // ë¦¬í¬íŠ¸ìš© ì ìˆ˜ ì €ì¥

            alert(`í›ˆë ¨ ì¢…ë£Œ!\nìµœì¢… ì ìˆ˜: ${score}ì \në‹¬ì„± ë ˆë²¨: ${n}-Back`);
            location.reload();
        }
    </script>
</body>
</html>
